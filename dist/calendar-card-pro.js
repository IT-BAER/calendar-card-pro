let t=!1;var e;!function(t){t[t.ERROR=0]="ERROR",t[t.WARN=1]="WARN",t[t.INFO=2]="INFO",t[t.DEBUG=3]="DEBUG"}(e||(e={}));let n=e.INFO;const i={title:["background: #424242","color: white","display: inline-block","line-height: 20px","text-align: center","border-radius: 20px 0 0 20px","font-size: 12px","font-weight: bold","padding: 4px 8px 4px 12px","margin: 5px 0"].join(";"),version:["background: #4fc3f7","color: white","display: inline-block","line-height: 20px","text-align: center","border-radius: 0 20px 20px 0","font-size: 12px","font-weight: bold","padding: 4px 12px 4px 8px","margin: 5px 0"].join(";"),prefix:["color: #4fc3f7","font-weight: bold"].join(";"),error:["color: #f44336","font-weight: bold"].join(";"),warn:["color: #ff9800","font-weight: bold"].join(";")};function r(r,o=!1){n=o?e.DEBUG:e.INFO,function(e){if(t)return;console.groupCollapsed("%cüìÖ Calendar Card Pro%cv"+e+" ",i.title,i.version),console.log("%c Description: %c A calendar card that supports multiple calendars with individual styling. ","font-weight: bold","font-weight: normal"),console.log("%c GitHub: %c https://github.com/alexpfau/calendar-card-pro ","font-weight: bold","font-weight: normal"),console.groupEnd(),t=!0}(r)}function o(t,...r){n>=e.ERROR&&(r.length>0?console.error(`%c[Calendar-Card-Pro] ${t}`,i.error,...r):console.error(`%c[Calendar-Card-Pro] ${t}`,i.error))}function a(t,...r){n>=e.WARN&&(r.length>0?console.warn(`%c[Calendar-Card-Pro] ${t}`,i.warn,...r):console.warn(`%c[Calendar-Card-Pro] ${t}`,i.warn))}function s(t,...r){n>=e.INFO&&(r.length>0?console.log(`%c[Calendar-Card-Pro] ${t}`,i.prefix,...r):console.log(`%c[Calendar-Card-Pro] ${t}`,i.prefix))}function c(t,...i){n>=e.DEBUG&&(i.length>0?console.log(`[Calendar-Card-Pro] ${t}`,...i):console.log(`[Calendar-Card-Pro] ${t}`))}"true"===localStorage.getItem("calendar-card-diagnostics")&&(interactionStyles.textContent+="\n    /* Diagnostic outlines for layer visualization */\n    .card-container::before {\n      outline: 2px solid blue !important;\n    }\n    .card-container::after {\n      outline: 2px solid red !important;\n    }\n    .card-content {\n      outline: 2px solid green !important;\n    }\n  ");const l={entities:[],days_to_show:3,max_events_to_show:void 0,show_past_events:!1,refresh_interval:30,cache_duration:30,language:"en",time_24h:!0,show_end_time:!0,show_month:!0,show_location:!0,remove_location_country:!0,title:"",background_color:"var(--ha-card-background)",row_spacing:"5px",additional_card_spacing:"0px",vertical_line_width:"2px",vertical_line_color:"#03a9f4",horizontal_line_width:"0px",horizontal_line_color:"var(--secondary-text-color)",title_font_size:"20px",weekday_font_size:"14px",day_font_size:"26px",month_font_size:"12px",event_font_size:"14px",time_font_size:"12px",location_font_size:"12px",time_location_icon_size:"16px",title_color:"var(--primary-text-color)",weekday_color:"var(--primary-text-color)",day_color:"var(--primary-text-color)",month_color:"var(--primary-text-color)",event_color:"var(--primary-text-color)",time_color:"var(--secondary-text-color)",location_color:"var(--secondary-text-color)",tap_action:{action:"none"},hold_action:{action:"none"}};function d(t){return Object.keys(t).find((t=>t.startsWith("calendar.")))||null}const h={en:{daysOfWeek:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],fullDaysOfWeek:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],allDay:"all-day",multiDay:"until",at:"at",noEvents:"No upcoming events",loading:"Loading calendar events...",error:"Error: Calendar entity not found or improperly configured"},de:{daysOfWeek:["So","Mo","Di","Mi","Do","Fr","Sa"],fullDaysOfWeek:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],months:["Jan","Feb","M√§r","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],allDay:"ganzt√§gig",multiDay:"bis",at:"um",noEvents:"Keine anstehenden Termine",loading:"Kalendereintr√§ge werden geladen...",error:"Fehler: Kalender-Entity nicht gefunden oder falsch konfiguriert"}};function p(t){const e=(null==t?void 0:t.toLowerCase())||"en";return h[e]||h.en}function u(t,e,n){return function(t,e,n){const i=p(t);return e in i?i[e]:void 0!==n?n:e}(t,e,n)}function g(t,e,n=!1){const i=p(t),r=n?"fullDaysOfWeek":"daysOfWeek";return(e<0||e>6)&&(console.warn(`Calendar-Card-Pro: Invalid day index ${e}. Using default.`),e=0),i[r][e]}function m(t,e){const n=p(t);return(e<0||e>11)&&(console.warn(`Calendar-Card-Pro: Invalid month index ${e}. Using default.`),e=0),n.months[e]}function f(t,e,n="en"){const i=new Date(t.start.dateTime||t.start.date||""),r=new Date(t.end.dateTime||t.end.date||""),o=p(n);if(!t.start.dateTime){const t=new Date(r);return t.setDate(t.getDate()-1),i.toDateString()!==t.toDateString()?function(t,e,n){const i=t.getDate(),r=n.months[t.getMonth()],o="de"===e?`${i}.`:i;return`${n.allDay}, ${n.multiDay} ${o} ${r}`}(t,n,o):o.allDay}return i.toDateString()!==r.toDateString()?function(t,e,n,i){const r=e.getDate(),o=i.months[e.getMonth()],a=i.fullDaysOfWeek[e.getDay()],s="de"===n?`${r}.`:r,c=v(t,!0),l=v(e,!0);return[c,i.multiDay,a+",",s,o,i.at,l].join(" ")}(i,r,n,o):function(t,e,n,i){return n?`${v(t,i)} - ${v(e,i)}`:v(t,i)}(i,r,e.show_end_time,e.time_24h)}function v(t,e=!0){let n=t.getHours();const i=t.getMinutes();if(!e){const t=n>=12?"PM":"AM";return n=n%12||12,`${n}:${i.toString().padStart(2,"0")} ${t}`}return`${n}:${i.toString().padStart(2,"0")}`}function y(t,e=!0){if(!t||!e)return t||"";const n=t.trim(),i=new Set(["Germany","Deutschland","United States","USA","United States of America","United Kingdom","Great Britain","France","Italy","Italia","Spain","Espa√±a","Netherlands","Nederland","Austria","√ñsterreich","Switzerland","Schweiz"]),r=n.split(",").map((t=>t.trim()));if(r.length>0&&i.has(r[r.length-1]))return r.pop(),r.join(", ");const o=n.split(/\s+/);return o.length>0&&i.has(o[o.length-1])?(o.pop(),o.join(" ")):n}async function _(t,e,n,i=!1,r=[]){if(!w(t,e.entities))return{events:r,fromCache:!1,error:null};const c=x(n,e.entities,e.days_to_show,e.show_past_events),l=!i&&C(c,e);if(l)return{events:l,fromCache:!0,error:null};try{const n=e.entities.map((t=>"string"==typeof t?{entity:t,color:"var(--primary-text-color)"}:t)),i=b(e.days_to_show),r=await async function(t,e,n){const i=[];for(const r of e)try{const e=`calendars/${r.entity}?start=${n.start.toISOString()}&end=${n.end.toISOString()}`;s(`Fetching calendar events with path: ${e}`);const o=await t.callApi("GET",e);if(!o||!Array.isArray(o)){a(`Invalid response for ${r.entity}`);continue}const c=o.map((t=>Object.assign(Object.assign({},t),{_entityId:r.entity})));i.push(...c)}catch(e){o(`Failed to fetch events for ${r.entity}:`,e);try{s("Available hass API methods:",Object.keys(t).filter((e=>"function"==typeof t[e])))}catch(t){}}return i}(t,n,i);return s(`Fetched ${r.length} events from ${n.length} calendars`),function(t,e){try{s(`Caching ${e.length} events`);const n={events:e,timestamp:Date.now()};return localStorage.setItem(t,JSON.stringify(n)),null!==E(t)}catch(t){return o("Failed to cache calendar events:",t),!1}}(c,[...r]),{events:[...r],fromCache:!1,error:null}}catch(n){if(o("API error:",n),0===r.length)try{s("Trying fallback to fetch today events");const i="string"==typeof e.entities[0]?e.entities[0]:e.entities[0].entity,r=await async function(t,e){try{const n=new Date,i=new Date(n.getFullYear(),n.getMonth(),n.getDate()),r=new Date(i);r.setHours(23,59,59,999);return await t.callApi("GET",`calendars/${e}?start=${i.toISOString()}&end=${r.toISOString()}`)}catch(t){return null}}(t,i);return{events:r?[...r]:[],fromCache:!1,error:n}}catch(t){return o("Fallback failed:",t),{events:[],fromCache:!1,error:t}}return{events:r,fromCache:!1,error:n}}}async function $(t){const{hass:e,config:n,instanceId:i,force:r,currentEvents:a,callbacks:c}=t;if(!w(e,n.entities))return;const l=x(i,n.entities,n.days_to_show,n.show_past_events);if(!r&&null!==E(l)){const t=C(l,n);if(t)return s(`Using ${t.length} events from cache`),c.setEvents(t),c.setLoading(!1),void c.renderCallback()}s("Fetching events from API"+(r?" (forced refresh)":"")),c.setLoading(!0),c.renderCallback();try{const t=await _(e,n,i,r,a);t.events&&(c.setEvents(t.events),c.updateLastUpdate()),t.error&&o("Error during event update:",t.error)}catch(t){o("Failed to update events:",t)}finally{c.setLoading(!1),c.renderCallback()}}function w(t,e){return!(!t||!e.length)}function b(t){const e=new Date,n=new Date(e.getFullYear(),e.getMonth(),e.getDate()),i=new Date(n),r=parseInt(t.toString())||3;return i.setDate(n.getDate()+r),i.setHours(23,59,59,999),{start:n,end:i}}function E(t,e){try{const n=localStorage.getItem(t);if(!n)return null;const i=JSON.parse(n),r=Date.now(),o=function(t){return 60*((null==t?void 0:t.cache_duration)||30)*1e3}(e);return r-i.timestamp<o?i:(localStorage.removeItem(t),s(`Cache expired and removed for ${t}`),null)}catch(e){a("Cache error:",e);try{localStorage.removeItem(t)}catch(t){}return null}}function C(t,e){const n=E(t,e);return n?[...n.events]:null}function x(t,e,n,i,r){const o=e.map((t=>"string"==typeof t?t:t.entity)).sort().join("_");return`calendar_data_${o}_${n}_${i?1:0}`}function A(t){return[t]}function T(t,e){if(!t)return"var(--primary-text-color)";const n=e.entities.find((e=>"string"==typeof e&&e===t||"object"==typeof e&&e.entity===t));return n?"string"==typeof n?"var(--primary-text-color)":n.color||"var(--primary-text-color)":"var(--primary-text-color)"}const S=new Set;function M(){S.size>0&&(c(`Cleaning up ${S.size} orphaned hold indicators`),S.forEach((t=>{D(t)})),S.clear())}function k(t){const e=t[0];return"string"==typeof e?e:e.entity}function I(t,e,n,i,r){if(t&&t.action&&"none"!==t.action){s(`Executing action: ${t.action}`);try{switch(t.action){case"more-info":!function(t,e){if(!e)return void a("Cannot show more-info - no entity ID provided");s(`Firing more-info for entity: ${e}`);try{const n=new CustomEvent("hass-more-info",{detail:{entityId:e},bubbles:!0,composed:!0,cancelable:!1});t.dispatchEvent(n)}catch(t){o("Error firing more-info event:",t)}}(n,i);break;case"navigate":!function(t){if(!t.navigation_path)return void a("Cannot navigate - no navigation path provided");s(`Navigating to: ${t.navigation_path}`);try{window.history.pushState(null,"",t.navigation_path);const e=new Event("location-changed",{bubbles:!0,cancelable:!1});window.dispatchEvent(e)}catch(t){o("Error during navigation:",t)}}(t);break;case"call-service":e?function(t,e){if(!e.service)return void a("Cannot call service - no service specified");const n=e.service.split(".");if(2!==n.length)return void o(`Invalid service format: ${e.service} - must be domain.service`);const[i,r]=n,c=e.service_data||{};s(`Calling service ${i}.${r}`,c);try{t.callService(i,r,c)}catch(t){o(`Error calling service ${i}.${r}:`,t)}}(e,t):a("Cannot call service - hass object not available");break;case"url":!function(t){if(!t.url_path)return void a("Cannot open URL - no URL path provided");s(`Opening URL: ${t.url_path}`);try{let e=t.url_path;e.startsWith("http://")||e.startsWith("https://")||e.startsWith("/")||(a(`Potentially unsafe URL: ${e} - adding https://`),e="https://"+e);const n=window.open(e,"_blank");n&&(n.opener=null)}catch(t){o("Error opening URL:",t)}}(t);break;case"expand":r();break;default:a(`Unknown action type: ${t.action}`)}}catch(e){o(`Error executing action ${t.action}:`,e)}}else c("No action or action set to none - ignoring")}function z(t){s("Creating hold indicator",{x:t.clientX,y:t.clientY});const e=document.createElement("div"),n=window.matchMedia("(pointer: coarse)").matches?100:50;return e.style.cssText=`\n    position: fixed !important;\n    width: ${n}px !important; \n    height: ${n}px !important;\n    left: ${t.clientX}px !important;\n    top: ${t.clientY}px !important;\n    border-radius: 50% !important;\n    background-color: var(--card-accent-color, var(--primary-color, #03a9f4)) !important;\n    opacity: 0 !important;\n    transform: translate(-50%, -50%) scale(0) !important;\n    transform-origin: center center !important;\n    pointer-events: none !important;\n    will-change: transform, opacity !important;\n    transition: transform 200ms cubic-bezier(0.2, 0, 0, 1), opacity 200ms cubic-bezier(0.2, 0, 0, 1) !important;\n    z-index: 999999 !important;\n    backface-visibility: hidden !important;\n  `,document.body.appendChild(e),S.add(e),e.offsetWidth,requestAnimationFrame((()=>{e.style.opacity="0.20",e.style.transform="translate(-50%, -50%) scale(1)"})),e}function D(t){t&&t.parentNode&&(t.style.opacity="0",t.style.transform="translate(-50%, -50%) scale(0.9)",S.delete(t),setTimeout((()=>{t.parentNode&&t.parentNode.removeChild(t)}),300))}function L(t,e){let n;return(...i)=>{clearTimeout(n),n=window.setTimeout((()=>{clearTimeout(n),t(...i)}),e)}}function R(t,e){const n=new Map;return Object.assign(((...i)=>{const r=JSON.stringify(i);if(n.has(r))return n.get(r);const o=e?t.call(e,...i):t(...i);return n.set(r,o),o}),{cache:n,clear:()=>n.clear()})}function O(t){return{startTime:performance.now(),eventCount:t}}function P(t){if(!t.renderTime.length)return 0;const e=t.renderTime.reduce(((t,e)=>t+e),0);return e/t.renderTime.length}function U(t,e,n){const i=t.map((t=>"string"==typeof t?t:t.entity)).sort().join("_");return function(t){let e=0;for(let n=0;n<t.length;n++){e=(e<<5)-e+t.charCodeAt(n),e|=0}return Math.abs(e).toString(36)}(`calendar_${i}_${e}_${n?1:0}`)}window.addEventListener("blur",(()=>{M()}));const N=100,H=10,F=50;function j(){return{beginMeasurement:O,endMeasurement:(t,e,n)=>function(t,e,n){const i=performance.now()-t.startTime,r=e;r.renderTime.push(i),r.renderTime.length>10&&r.renderTime.shift();const o=P(e);return o>n&&a("Poor rendering performance detected",{averageRenderTime:o,eventCount:t.eventCount}),i}(t,e,n||N),getAverageRenderTime:P}}function W(t){t.join("_"),function(){try{const t=[],e=Date.now();Object.keys(localStorage).filter((t=>t.startsWith("calendar_data_"))).forEach((n=>{try{const i=JSON.parse(localStorage.getItem(n)||"");e-i.timestamp>864e5&&t.push(n)}catch(e){t.push(n)}})),t.length>0&&(s(`Cleaned up ${t.length} old cache entries`),t.forEach((t=>localStorage.removeItem(t))))}catch(t){a("Cache cleanup failed:",t)}}()}function B(t){return`\n    ${function(t){return`\n    :host {\n      --card-font-size-title: ${t.title_font_size};\n      --card-font-size-weekday: ${t.weekday_font_size};\n      --card-font-size-day: ${t.day_font_size};\n      --card-font-size-month: ${t.month_font_size};\n      --card-font-size-event: ${t.event_font_size};\n      --card-font-size-time: ${t.time_font_size};\n      --card-font-size-location: ${t.location_font_size};\n      --card-color-title: ${t.title_color};\n      --card-color-weekday: ${t.weekday_color};\n      --card-color-day: ${t.day_color};\n      --card-color-month: ${t.month_color};\n      --card-color-event: ${t.event_color};\n      --card-color-time: ${t.time_color};\n      --card-color-location: ${t.location_color};\n      --card-line-color-vertical: ${t.vertical_line_color};\n      --card-line-color-horizontal: ${t.horizontal_line_color};\n      --card-line-width-vertical: ${t.vertical_line_width};\n      --card-line-width-horizontal: ${t.horizontal_line_width};\n      --card-spacing-row: ${t.row_spacing};\n      --card-spacing-additional: ${t.additional_card_spacing};\n      --card-icon-size: ${t.time_location_icon_size};\n      --card-date-column-width: ${1.75*parseFloat(t.day_font_size)}px;\n      --card-custom-background: ${t.background_color};\n\n      /* Variables for ripple effect */\n      --ha-ripple-hover-opacity: 0.04;\n      --ha-ripple-hover-color: var(--card-line-color-vertical, var(--primary-color, #03a9f4));\n      --ha-ripple-pressed-opacity: 0.12;\n      --ha-ripple-pressed-color: var(--card-line-color-vertical, var(--primary-color, #03a9f4));\n    }\n  `}(t)}\n    \n    :host {\n      display: block;\n    }\n    .card-container {\n      cursor: pointer;\n      width: 100%;\n      height: 100%;\n      position: relative;\n      overflow: hidden;\n      border-radius: var(--ha-card-border-radius, 10px);\n      transition: transform 180ms ease-in-out;\n    }\n    \n    /* Background layer for ripple - matching HA pattern */\n    .background {\n      position: absolute;\n      top: 0;\n      left: 0;\n      bottom: 0;\n      right: 0;\n      border-radius: var(--ha-card-border-radius, 12px);\n      margin: calc(-1 * var(--ha-card-border-width, 1px));\n      overflow: hidden;\n    }\n    \n    /* Content container for proper layering */\n    .content-container {\n      position: relative;\n      z-index: 1;\n    }\n    \n    .card-content {\n      background: var(--card-custom-background, var(--card-background-color, #FFF));\n      border: var(--ha-card-border-width, 1px) solid var(--ha-card-border-color, var(--divider-color));\n      border-radius: var(--ha-card-border-radius, 10px);\n      padding: 16px;\n      padding-top: calc(16px + var(--card-spacing-additional));\n      padding-bottom: calc(16px + var(--card-spacing-additional));\n    }\n    .title {\n      font-size: var(--card-font-size-title);\n      line-height: var(--card-font-size-title);\n      font-weight: 500;\n      color: var(--card-color-title);\n      margin-bottom: 16px;\n    }\n    ha-icon {\n      margin-right: 4px;\n      --mdc-icon-size: var(--card-icon-size);\n      vertical-align: middle;\n      position: relative;\n      transform: translateZ(0);\n    }\n    table {\n      width: 100%;\n      table-layout: fixed;\n      border-spacing: 0;\n      margin-bottom: var(--card-spacing-row);\n      border-bottom: var(--card-line-width-horizontal) solid var(--card-line-color-horizontal);\n      padding-bottom: var(--card-spacing-row);\n    }\n    .date {\n      width: var(--card-date-column-width);\n      text-align: center;\n      padding-right: 12px;\n      border-right: var(--card-line-width-vertical) solid var(--card-line-color-vertical);\n    }\n    .weekday {\n      font-size: var(--card-font-size-weekday);\n      line-height: var(--card-font-size-weekday);\n      color: var(--card-color-weekday);\n    }\n    .day {\n      font-size: var(--card-font-size-day);\n      line-height: var(--card-font-size-day);\n      font-weight: 500;\n      color: var(--card-color-day);\n    }\n    .month {\n      font-size: var(--card-font-size-month);\n      line-height: var(--card-font-size-month);\n      text-transform: uppercase;\n      color: var(--card-color-month);\n    }\n    .event {\n      padding-left: 12px;\n    }\n    .event-title {\n      font-size: var(--card-font-size-event);\n      font-weight: 500;\n      color: var(--card-color-event);\n    }\n    .time-location {\n      display: flex;\n      flex-direction: column;\n      margin-top: 0px;\n    }\n    .time, .location {\n      display: flex;\n      align-items: center;\n      line-height: 1.2;\n    }\n    .time {\n      font-size: var(--card-font-size-time);\n      color: var(--card-color-time);\n    }\n    .location {\n      font-size: var(--card-font-size-location);\n      color: var(--card-color-location);\n      margin-top: 2px;\n    }\n    table:last-of-type {\n      margin-bottom: 0;\n      border-bottom: 0;\n      padding-bottom: 0;\n    }\n    .no-events {\n      text-align: center;\n      color: var(--secondary-text-color);\n      font-style: italic;\n      padding: 16px;\n    }\n      }\n    }\n  \n  `}function J(t){for(;t.firstChild;)t.removeChild(t.firstChild)}async function G(t,e,n,i,r,o){const a=document.createElement("div");if(a.className="card-content",t.title){const e=document.createElement("h2");e.className="title",e.textContent=t.title,a.appendChild(e)}const s=await async function(t,e,n,i,r=10,o=50){if(!t.length){const t=document.createDocumentFragment(),e=document.createElement("div");return e.className="no-events",e.textContent="No upcoming events",t.appendChild(e),t}const a=document.createDocumentFragment(),s=async c=>{const l=t.slice(c,c+r);l.length&&(l.forEach((t=>{if(0===t.events.length)return;const r=document.createElement("table");r.innerHTML=V(t,e,n,i),a.appendChild(r)})),c+r<t.length&&(await new Promise((t=>setTimeout(t,o))),await s(c+r)))};return await s(0),a}(e,t,n,i,r,o);a.appendChild(s);const c=document.createElement("style");return c.textContent=B(t),{container:a,style:c}}function K(t,e,n){J(t);const i=function(t,e){if("loading"===t){const t=document.createElement("div");t.className="card-container";const n=document.createElement("div");n.className="card-content",n.innerHTML=`\n      <div style="text-align: center; color: var(--primary-text-color);">\n        ${u(e.language,"loading")}\n      </div>`,t.appendChild(n);const i=document.createElement("style");return i.textContent=B(e),{container:t,style:i}}if("empty"===t){const t=new Date,n={weekday:g(e.language,t.getDay()),day:t.getDate(),month:m(e.language,t.getMonth()),events:[{summary:u(e.language,"noEvents"),time:"",location:"",_entityId:""}]},i=document.createElement("div");i.className="card-container";const r=document.createElement("div");r.className="card-content";const o=e.event_color||"var(--secondary-text-color)";r.innerHTML=`\n      <table>\n        <tr>\n          <td class="date" rowspan="1">\n            <div class="date-content">\n              <div class="weekday">${n.weekday}</div>\n              <div class="day">${n.day}</div>\n              ${e.show_month?`<div class="month">${n.month}</div>`:""}\n            </div>\n          </td>\n          <td class="event">\n            <div class="event-content">\n              <div class="event-title" style="color: ${o}">\n                ${n.events[0].summary}\n              </div>\n            </div>\n          </td>\n        </tr>\n      </table>`,i.appendChild(r);const a=document.createElement("style");return a.textContent=B(e),{container:i,style:a}}const n={error:`<p style="color: var(--error-color, red);">${u(e.language,"error")}</p>`,loading:`<p style="color: var(--secondary-text-color);">${u(e.language,"loading")}</p>`},i=`\n    <div class="card-content">\n      ${n[t]}\n    </div>\n  `,r="\n    .card-content {\n      background: var(--card-background-color, #FFF);\n      border: var(--ha-card-border-width, 1px) solid var(--ha-card-border-color, var(--divider-color));\n      border-radius: var(--ha-card-border-radius, 10px);\n      padding: 16px;\n      color: var(--primary-text-color);\n      text-align: center;\n    }\n  ";return{html:i,styleText:r}}(e,n);"container"in i&&"style"in i?(t.appendChild(i.style),t.appendChild(i.container)):t.innerHTML=`\n      <style>${i.styleText}</style>\n      ${i.html}\n    `}function V(t,e,n,i){return t.events.map(((r,o)=>{const a=T(r._entityId,e);return`\n    <tr>\n      ${0===o?`\n        <td class="date" rowspan="${t.events.length}">\n          <div class="date-content">\n            <div class="weekday">${t.weekday}</div>\n            <div class="day">${t.day}</div>\n            ${e.show_month?`<div class="month">${t.month}</div>`:""}\n          </div>\n        </td>\n      `:""}\n      <td class="event">\n        <div class="event-content">\n          <div class="event-title" style="color: ${a}">${r.summary}</div>\n          <div class="time-location">\n            <div class="time">\n              <ha-icon icon="hass:clock-outline"></ha-icon>\n              <span>${n(r)}</span>\n            </div>\n            ${r.location&&e.show_location?`\n              <div class="location">\n                <ha-icon icon="hass:map-marker"></ha-icon>\n                <span>${i(r.location)}</span>\n              </div>\n            `:""}\n          </div>\n        </div>\n      </td>\n    </tr>\n  `})).join("")}class q extends HTMLElement{setConfig(t){}}
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Y=globalThis,Z=Y.ShadowRoot&&(void 0===Y.ShadyCSS||Y.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,X=Symbol(),Q=new WeakMap;let tt=class{constructor(t,e,n){if(this._$cssResult$=!0,n!==X)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=e}get styleSheet(){let t=this.o;const e=this.t;if(Z&&void 0===t){const n=void 0!==e&&1===e.length;n&&(t=Q.get(e)),void 0===t&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),n&&Q.set(e,t))}return t}toString(){return this.cssText}};const et=Z?t=>t:t=>t instanceof CSSStyleSheet?(t=>{let e="";for(const n of t.cssRules)e+=n.cssText;return(t=>new tt("string"==typeof t?t:t+"",void 0,X))(e)})(t):t
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */,{is:nt,defineProperty:it,getOwnPropertyDescriptor:rt,getOwnPropertyNames:ot,getOwnPropertySymbols:at,getPrototypeOf:st}=Object,ct=globalThis,lt=ct.trustedTypes,dt=lt?lt.emptyScript:"",ht=ct.reactiveElementPolyfillSupport,pt=(t,e)=>t,ut={toAttribute(t,e){switch(e){case Boolean:t=t?dt:null;break;case Object:case Array:t=null==t?t:JSON.stringify(t)}return t},fromAttribute(t,e){let n=t;switch(e){case Boolean:n=null!==t;break;case Number:n=null===t?null:Number(t);break;case Object:case Array:try{n=JSON.parse(t)}catch(t){n=null}}return n}},gt=(t,e)=>!nt(t,e),mt={attribute:!0,type:String,converter:ut,reflect:!1,hasChanged:gt};Symbol.metadata??=Symbol("metadata"),ct.litPropertyMetadata??=new WeakMap;class ft extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??=[]).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,e=mt){if(e.state&&(e.attribute=!1),this._$Ei(),this.elementProperties.set(t,e),!e.noAccessor){const n=Symbol(),i=this.getPropertyDescriptor(t,n,e);void 0!==i&&it(this.prototype,t,i)}}static getPropertyDescriptor(t,e,n){const{get:i,set:r}=rt(this.prototype,t)??{get(){return this[e]},set(t){this[e]=t}};return{get(){return i?.call(this)},set(e){const o=i?.call(this);r.call(this,e),this.requestUpdate(t,o,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??mt}static _$Ei(){if(this.hasOwnProperty(pt("elementProperties")))return;const t=st(this);t.finalize(),void 0!==t.l&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(pt("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(pt("properties"))){const t=this.properties,e=[...ot(t),...at(t)];for(const n of e)this.createProperty(n,t[n])}const t=this[Symbol.metadata];if(null!==t){const e=litPropertyMetadata.get(t);if(void 0!==e)for(const[t,n]of e)this.elementProperties.set(t,n)}this._$Eh=new Map;for(const[t,e]of this.elementProperties){const n=this._$Eu(t,e);void 0!==n&&this._$Eh.set(n,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){const e=[];if(Array.isArray(t)){const n=new Set(t.flat(1/0).reverse());for(const t of n)e.unshift(et(t))}else void 0!==t&&e.push(et(t));return e}static _$Eu(t,e){const n=e.attribute;return!1===n?void 0:"string"==typeof n?n:"string"==typeof t?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise((t=>this.enableUpdating=t)),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach((t=>t(this)))}addController(t){(this._$EO??=new Set).add(t),void 0!==this.renderRoot&&this.isConnected&&t.hostConnected?.()}removeController(t){this._$EO?.delete(t)}_$E_(){const t=new Map,e=this.constructor.elementProperties;for(const n of e.keys())this.hasOwnProperty(n)&&(t.set(n,this[n]),delete this[n]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return((t,e)=>{if(Z)t.adoptedStyleSheets=e.map((t=>t instanceof CSSStyleSheet?t:t.styleSheet));else for(const n of e){const e=document.createElement("style"),i=Y.litNonce;void 0!==i&&e.setAttribute("nonce",i),e.textContent=n.cssText,t.appendChild(e)}})(t,this.constructor.elementStyles),t}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach((t=>t.hostConnected?.()))}enableUpdating(t){}disconnectedCallback(){this._$EO?.forEach((t=>t.hostDisconnected?.()))}attributeChangedCallback(t,e,n){this._$AK(t,n)}_$EC(t,e){const n=this.constructor.elementProperties.get(t),i=this.constructor._$Eu(t,n);if(void 0!==i&&!0===n.reflect){const r=(void 0!==n.converter?.toAttribute?n.converter:ut).toAttribute(e,n.type);this._$Em=t,null==r?this.removeAttribute(i):this.setAttribute(i,r),this._$Em=null}}_$AK(t,e){const n=this.constructor,i=n._$Eh.get(t);if(void 0!==i&&this._$Em!==i){const t=n.getPropertyOptions(i),r="function"==typeof t.converter?{fromAttribute:t.converter}:void 0!==t.converter?.fromAttribute?t.converter:ut;this._$Em=i,this[i]=r.fromAttribute(e,t.type),this._$Em=null}}requestUpdate(t,e,n){if(void 0!==t){if(n??=this.constructor.getPropertyOptions(t),!(n.hasChanged??gt)(this[t],e))return;this.P(t,e,n)}!1===this.isUpdatePending&&(this._$ES=this._$ET())}P(t,e,n){this._$AL.has(t)||this._$AL.set(t,e),!0===n.reflect&&this._$Em!==t&&(this._$Ej??=new Set).add(t)}async _$ET(){this.isUpdatePending=!0;try{await this._$ES}catch(t){Promise.reject(t)}const t=this.scheduleUpdate();return null!=t&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[t,e]of this._$Ep)this[t]=e;this._$Ep=void 0}const t=this.constructor.elementProperties;if(t.size>0)for(const[e,n]of t)!0!==n.wrapped||this._$AL.has(e)||void 0===this[e]||this.P(e,this[e],n)}let t=!1;const e=this._$AL;try{t=this.shouldUpdate(e),t?(this.willUpdate(e),this._$EO?.forEach((t=>t.hostUpdate?.())),this.update(e)):this._$EU()}catch(e){throw t=!1,this._$EU(),e}t&&this._$AE(e)}willUpdate(t){}_$AE(t){this._$EO?.forEach((t=>t.hostUpdated?.())),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Ej&&=this._$Ej.forEach((t=>this._$EC(t,this[t]))),this._$EU()}updated(t){}firstUpdated(t){}}ft.elementStyles=[],ft.shadowRootOptions={mode:"open"},ft[pt("elementProperties")]=new Map,ft[pt("finalized")]=new Map,ht?.({ReactiveElement:ft}),(ct.reactiveElementVersions??=[]).push("2.0.4");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const vt=globalThis,yt=vt.trustedTypes,_t=yt?yt.createPolicy("lit-html",{createHTML:t=>t}):void 0,$t="$lit$",wt=`lit$${Math.random().toFixed(9).slice(2)}$`,bt="?"+wt,Et=`<${bt}>`,Ct=document,xt=()=>Ct.createComment(""),At=t=>null===t||"object"!=typeof t&&"function"!=typeof t,Tt=Array.isArray,St="[ \t\n\f\r]",Mt=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,kt=/-->/g,It=/>/g,zt=RegExp(`>|${St}(?:([^\\s"'>=/]+)(${St}*=${St}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),Dt=/'/g,Lt=/"/g,Rt=/^(?:script|style|textarea|title)$/i,Ot=(t=>(e,...n)=>({_$litType$:t,strings:e,values:n}))(1),Pt=Symbol.for("lit-noChange"),Ut=Symbol.for("lit-nothing"),Nt=new WeakMap,Ht=Ct.createTreeWalker(Ct,129);function Ft(t,e){if(!Tt(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==_t?_t.createHTML(e):e}const jt=(t,e)=>{const n=t.length-1,i=[];let r,o=2===e?"<svg>":3===e?"<math>":"",a=Mt;for(let e=0;e<n;e++){const n=t[e];let s,c,l=-1,d=0;for(;d<n.length&&(a.lastIndex=d,c=a.exec(n),null!==c);)d=a.lastIndex,a===Mt?"!--"===c[1]?a=kt:void 0!==c[1]?a=It:void 0!==c[2]?(Rt.test(c[2])&&(r=RegExp("</"+c[2],"g")),a=zt):void 0!==c[3]&&(a=zt):a===zt?">"===c[0]?(a=r??Mt,l=-1):void 0===c[1]?l=-2:(l=a.lastIndex-c[2].length,s=c[1],a=void 0===c[3]?zt:'"'===c[3]?Lt:Dt):a===Lt||a===Dt?a=zt:a===kt||a===It?a=Mt:(a=zt,r=void 0);const h=a===zt&&t[e+1].startsWith("/>")?" ":"";o+=a===Mt?n+Et:l>=0?(i.push(s),n.slice(0,l)+$t+n.slice(l)+wt+h):n+wt+(-2===l?e:h)}return[Ft(t,o+(t[n]||"<?>")+(2===e?"</svg>":3===e?"</math>":"")),i]};class Wt{constructor({strings:t,_$litType$:e},n){let i;this.parts=[];let r=0,o=0;const a=t.length-1,s=this.parts,[c,l]=jt(t,e);if(this.el=Wt.createElement(c,n),Ht.currentNode=this.el.content,2===e||3===e){const t=this.el.content.firstChild;t.replaceWith(...t.childNodes)}for(;null!==(i=Ht.nextNode())&&s.length<a;){if(1===i.nodeType){if(i.hasAttributes())for(const t of i.getAttributeNames())if(t.endsWith($t)){const e=l[o++],n=i.getAttribute(t).split(wt),a=/([.?@])?(.*)/.exec(e);s.push({type:1,index:r,name:a[2],strings:n,ctor:"."===a[1]?Vt:"?"===a[1]?qt:"@"===a[1]?Yt:Kt}),i.removeAttribute(t)}else t.startsWith(wt)&&(s.push({type:6,index:r}),i.removeAttribute(t));if(Rt.test(i.tagName)){const t=i.textContent.split(wt),e=t.length-1;if(e>0){i.textContent=yt?yt.emptyScript:"";for(let n=0;n<e;n++)i.append(t[n],xt()),Ht.nextNode(),s.push({type:2,index:++r});i.append(t[e],xt())}}}else if(8===i.nodeType)if(i.data===bt)s.push({type:2,index:r});else{let t=-1;for(;-1!==(t=i.data.indexOf(wt,t+1));)s.push({type:7,index:r}),t+=wt.length-1}r++}}static createElement(t,e){const n=Ct.createElement("template");return n.innerHTML=t,n}}function Bt(t,e,n=t,i){if(e===Pt)return e;let r=void 0!==i?n._$Co?.[i]:n._$Cl;const o=At(e)?void 0:e._$litDirective$;return r?.constructor!==o&&(r?._$AO?.(!1),void 0===o?r=void 0:(r=new o(t),r._$AT(t,n,i)),void 0!==i?(n._$Co??=[])[i]=r:n._$Cl=r),void 0!==r&&(e=Bt(t,r._$AS(t,e.values),r,i)),e}class Jt{constructor(t,e){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:e},parts:n}=this._$AD,i=(t?.creationScope??Ct).importNode(e,!0);Ht.currentNode=i;let r=Ht.nextNode(),o=0,a=0,s=n[0];for(;void 0!==s;){if(o===s.index){let e;2===s.type?e=new Gt(r,r.nextSibling,this,t):1===s.type?e=new s.ctor(r,s.name,s.strings,this,t):6===s.type&&(e=new Zt(r,this,t)),this._$AV.push(e),s=n[++a]}o!==s?.index&&(r=Ht.nextNode(),o++)}return Ht.currentNode=Ct,i}p(t){let e=0;for(const n of this._$AV)void 0!==n&&(void 0!==n.strings?(n._$AI(t,n,e),e+=n.strings.length-2):n._$AI(t[e])),e++}}class Gt{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(t,e,n,i){this.type=2,this._$AH=Ut,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=n,this.options=i,this._$Cv=i?.isConnected??!0}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return void 0!==e&&11===t?.nodeType&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=Bt(this,t,e),At(t)?t===Ut||null==t||""===t?(this._$AH!==Ut&&this._$AR(),this._$AH=Ut):t!==this._$AH&&t!==Pt&&this._(t):void 0!==t._$litType$?this.$(t):void 0!==t.nodeType?this.T(t):(t=>Tt(t)||"function"==typeof t?.[Symbol.iterator])(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==Ut&&At(this._$AH)?this._$AA.nextSibling.data=t:this.T(Ct.createTextNode(t)),this._$AH=t}$(t){const{values:e,_$litType$:n}=t,i="number"==typeof n?this._$AC(t):(void 0===n.el&&(n.el=Wt.createElement(Ft(n.h,n.h[0]),this.options)),n);if(this._$AH?._$AD===i)this._$AH.p(e);else{const t=new Jt(i,this),n=t.u(this.options);t.p(e),this.T(n),this._$AH=t}}_$AC(t){let e=Nt.get(t.strings);return void 0===e&&Nt.set(t.strings,e=new Wt(t)),e}k(t){Tt(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let n,i=0;for(const r of t)i===e.length?e.push(n=new Gt(this.O(xt()),this.O(xt()),this,this.options)):n=e[i],n._$AI(r),i++;i<e.length&&(this._$AR(n&&n._$AB.nextSibling,i),e.length=i)}_$AR(t=this._$AA.nextSibling,e){for(this._$AP?.(!1,!0,e);t&&t!==this._$AB;){const e=t.nextSibling;t.remove(),t=e}}setConnected(t){void 0===this._$AM&&(this._$Cv=t,this._$AP?.(t))}}class Kt{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,e,n,i,r){this.type=1,this._$AH=Ut,this._$AN=void 0,this.element=t,this.name=e,this._$AM=i,this.options=r,n.length>2||""!==n[0]||""!==n[1]?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=Ut}_$AI(t,e=this,n,i){const r=this.strings;let o=!1;if(void 0===r)t=Bt(this,t,e,0),o=!At(t)||t!==this._$AH&&t!==Pt,o&&(this._$AH=t);else{const i=t;let a,s;for(t=r[0],a=0;a<r.length-1;a++)s=Bt(this,i[n+a],e,a),s===Pt&&(s=this._$AH[a]),o||=!At(s)||s!==this._$AH[a],s===Ut?t=Ut:t!==Ut&&(t+=(s??"")+r[a+1]),this._$AH[a]=s}o&&!i&&this.j(t)}j(t){t===Ut?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class Vt extends Kt{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===Ut?void 0:t}}class qt extends Kt{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==Ut)}}class Yt extends Kt{constructor(t,e,n,i,r){super(t,e,n,i,r),this.type=5}_$AI(t,e=this){if((t=Bt(this,t,e,0)??Ut)===Pt)return;const n=this._$AH,i=t===Ut&&n!==Ut||t.capture!==n.capture||t.once!==n.once||t.passive!==n.passive,r=t!==Ut&&(n===Ut||i);i&&this.element.removeEventListener(this.name,this,n),r&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){"function"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,t):this._$AH.handleEvent(t)}}class Zt{constructor(t,e,n){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(t){Bt(this,t)}}const Xt=vt.litHtmlPolyfillSupport;Xt?.(Wt,Gt),(vt.litHtmlVersions??=[]).push("3.2.1");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
class Qt extends ft{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const t=super.createRenderRoot();return this.renderOptions.renderBefore??=t.firstChild,t}update(t){const e=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=((t,e,n)=>{const i=n?.renderBefore??e;let r=i._$litPart$;if(void 0===r){const t=n?.renderBefore??null;i._$litPart$=r=new Gt(e.insertBefore(xt(),t),t,void 0,n??{})}return r._$AI(t),r})(e,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return Pt}}Qt._$litElement$=!0,Qt.finalized=!0,globalThis.litElementHydrateSupport?.({LitElement:Qt});const te=globalThis.litElementPolyfillSupport;te?.({LitElement:Qt}),(globalThis.litElementVersions??=[]).push("4.1.1");class ee extends Qt{constructor(){super(...arguments),this._disabled=!1,this.control=null,this.haRipple=null,this._handleClick=()=>{const t=new CustomEvent("mdw:action",{bubbles:!0,composed:!0,detail:{source:"click"}});this.control?this.control.dispatchEvent(t):this.dispatchEvent(t)}}get disabled(){return this._disabled}set disabled(t){const e=this._disabled;this._disabled=t,this.requestUpdate("disabled",e),t?this.setAttribute("disabled",""):this.removeAttribute("disabled")}connectedCallback(){super.connectedCallback(),this.haRipple=document.createElement("ha-ripple"),this.appendChild(this.haRipple),this.control&&this.attachRipple(this.control)}attach(t){this.control=t,this.attachRipple(t),t.addEventListener("click",this._handleClick)}attachRipple(t){if(this.haRipple&&"attach"in this.haRipple)try{this.haRipple.attach(t)}catch(t){console.warn("Failed to attach ha-ripple:",t)}}detach(){if(this.control){if(this.control.removeEventListener("click",this._handleClick),this.haRipple&&"detach"in this.haRipple)try{this.haRipple.detach()}catch(t){console.warn("Failed to detach ha-ripple:",t)}this.control=null}}dispatchAction(t="click"){const e=new CustomEvent("mdw:action",{bubbles:!0,composed:!0,detail:{source:t}});this.control?this.control.dispatchEvent(e):this.dispatchEvent(e)}render(){return Ot`<slot></slot>`}}ee.styles=((t,...e)=>{const n=1===t.length?t[0]:e.reduce(((e,n,i)=>e+(t=>{if(!0===t._$cssResult$)return t.cssText;if("number"==typeof t)return t;throw Error("Value passed to 'css' function must be a 'css' function result: "+t+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(n)+t[i+1]),t[0]);return new tt(n,t,X)})`
    :host {
      display: block;
      position: absolute;
      inset: 0;
      overflow: hidden;
      border-radius: inherit;

      /* Map our calendar-specific variables to MD ripple variables */
      --md-ripple-hover-opacity: var(--ha-ripple-hover-opacity, 0.08);
      --md-ripple-pressed-opacity: var(--ha-ripple-pressed-opacity, 0.12);
      --md-ripple-hover-color: var(--ha-ripple-color, var(--primary-color));
      --md-ripple-pressed-color: var(--ha-ripple-color, var(--primary-color));
    }
  `;try{customElements.define("calendar-ripple",ee)}catch($t){console.warn("Could not register calendar-ripple:",$t)}
/**
 * Calendar Card Pro for Home Assistant
 *
 * This is the main entry point for the Calendar Card Pro custom card.
 * It orchestrates the different modules and handles the core web component lifecycle.
 *
 * Design inspired by Home Assistant community member @GHA_Steph's button-card calendar design
 * https://community.home-assistant.io/t/calendar-add-on-some-calendar-designs/385790
 *
 * Interaction patterns inspired by Home Assistant's Tile Card
 * and Material Design, both licensed under the Apache License 2.0.
 * https://github.com/home-assistant/frontend/blob/dev/LICENSE.md
 *
 * @license MIT
 * @version 0.1.0
 */const ne="0.1.0";class ie extends HTMLElement{static get DEFAULT_CONFIG(){return l}static get TRANSLATIONS(){return h}static findCalendarEntity(t){return d(t.states)}static getStubConfig(t){return function(t){const e=d(t);return{type:"custom:calendar-card-pro-dev",entities:e?[e]:[],days_to_show:3,show_location:!0,_description:e?void 0:"A calendar card that displays events from multiple calendars with individual styling. Add a calendar integration to Home Assistant to use this card."}}(t.states)}static get displayName(){return"Calendar Card Pro"}constructor(){super(),this.events=[],this._hass=null,this.isLoading=!0,this.isExpanded=!1,this.performanceMetrics={renderTime:[],eventCount:0,lastUpdate:Date.now()},this.eventListenerCleanup=null,this.interactionManager={state:{holdTimer:null,holdTriggered:!1,holdIndicator:null,activePointerId:null,pendingHoldAction:!1,lastActionTime:0,lastPointerEvent:null},container:null,cleanup:null},this.attachShadow({mode:"open"}),this.instanceId=Math.random().toString(36).substring(2,15),this.initializeState(),r(ne),this.performanceTracker=j(),this.visibilityCleanup=function(t,e){const n=()=>{"visible"===document.visibilityState&&Date.now()-e()>3e5&&t()};return document.addEventListener("visibilitychange",n),()=>document.removeEventListener("visibilitychange",n)}((()=>this.updateEvents()),(()=>this.performanceMetrics.lastUpdate)),this.refreshTimer=function(t,e){let n;const i=()=>{void 0!==n&&(clearInterval(n),n=void 0,c("Stopped refresh timer"))};return{start:()=>{i();const r=e();n=window.setInterval((()=>t(!0)),6e4*r),c(`Started refresh timer with interval ${r} minutes`)},stop:i}}(((t=!1)=>this.updateEvents(t)),(()=>{var t;return(null===(t=this.config)||void 0===t?void 0:t.refresh_interval)||30})),this.debouncedUpdate=L((()=>this.updateEvents()),300),this.memoizedFormatTime=R((t=>v(t,this.config.time_24h)),this),this.memoizedFormatLocation=R((t=>y(t,this.config.remove_location_country)),this),this.cleanupInterval=window.setInterval((()=>this.cleanupCache()),36e5),this.refreshTimer.start()}disconnectedCallback(){this.visibilityCleanup&&(this.visibilityCleanup(),this.visibilityCleanup=void 0),this.refreshTimer&&(this.refreshTimer.stop(),this.refreshTimer=void 0),clearInterval(this.cleanupInterval),this.cleanup(),this.eventListenerCleanup&&(this.eventListenerCleanup(),this.eventListenerCleanup=null),this.interactionManager.cleanup&&(this.interactionManager.cleanup(),this.interactionManager.cleanup=null),this.interactionManager.state.holdTimer&&(clearTimeout(this.interactionManager.state.holdTimer),this.interactionManager.state.holdTimer=null),this.interactionManager.state.holdIndicator&&(c("Cleaning up orphaned hold indicator in disconnectedCallback"),D(this.interactionManager.state.holdIndicator),this.interactionManager.state.holdIndicator=null),this.interactionManager.state.holdTriggered=!1,this.interactionManager.state.pendingHoldAction=!1,this.interactionManager.state.activePointerId=null,M(),this.shadowRoot&&J(this.shadowRoot)}formatLocation(t){return y(t,this.config.remove_location_country)}initializeState(){const t={config:Object.assign({},l),events:[],hass:null,isLoading:!0,isExpanded:!1};this.config=t.config,this.events=t.events,this._hass=t.hass,this.isLoading=t.isLoading,this.isExpanded=t.isExpanded}cleanup(){var t,e,n,i,r;this.renderTimeout&&(clearTimeout(this.renderTimeout),this.renderTimeout=void 0),this.memoizedFormatTime&&"cache"in this.memoizedFormatTime&&(null===(t=this.memoizedFormatTime.cache)||void 0===t||t.clear()),this.memoizedFormatLocation&&"cache"in this.memoizedFormatLocation&&(null===(e=this.memoizedFormatLocation.cache)||void 0===e||e.clear()),this.interactionManager.state.holdIndicator&&(c("Cleaning up hold indicator in cleanup method"),D(this.interactionManager.state.holdIndicator),this.interactionManager.state.holdIndicator=null),n=this.renderTimeout,i=this.memoizedFormatTime,r=this.memoizedFormatLocation,n&&clearTimeout(n),i.cache.clear(),r.cache.clear()}cleanupCache(){W(this.config.entities)}get translations(){return p(this.config.language||"en")}set hass(t){const e=this._hass;this._hass=t;this.config.entities.some((n=>{var i,r;return!e||(null===(i=e.states["string"==typeof n?n:n.entity])||void 0===i?void 0:i.state)!==(null===(r=t.states["string"==typeof n?n:n.entity])||void 0===r?void 0:r.state)}))&&this.updateEvents()}setConfig(t){const e=this.config;var n;this.config=Object.assign(Object.assign({},ie.DEFAULT_CONFIG),t),this.config.entities=(n=this.config.entities,Array.isArray(n)?n.map((t=>"string"==typeof t?{entity:t,color:"var(--primary-text-color)"}:"object"==typeof t&&t.entity?{entity:t.entity,color:t.color||"var(--primary-text-color)"}:null)).filter(Boolean):[]),this.instanceId=U(this.config.entities,this.config.days_to_show,this.config.show_past_events);const i=function(t,e){if(!t||0===Object.keys(t).length)return!0;const n=(t.entities||[]).map((t=>"string"==typeof t?t:t.entity)).sort().join(","),i=(e.entities||[]).map((t=>"string"==typeof t?t:t.entity)).sort().join(","),r=(null==t?void 0:t.refresh_interval)!==(null==e?void 0:e.refresh_interval),o=n!==i||t.days_to_show!==e.days_to_show||t.show_past_events!==e.show_past_events||t.cache_duration!==e.cache_duration;return(o||r)&&s("Configuration change requires data refresh"),o||r}(e,this.config),r=function(t,e){if(!t||!t.entities)return!1;const n=t.entities,i=e.entities;if(n.length!==i.length)return!1;const r=new Map;n.forEach((t=>{"string"==typeof t?r.set(t,"var(--primary-text-color)"):r.set(t.entity,t.color||"var(--primary-text-color)")}));for(const t of i){const e="string"==typeof t?t:t.entity,n="string"==typeof t?"var(--primary-text-color)":t.color||"var(--primary-text-color)";if(r.has(e)&&r.get(e)!==n)return s(`Entity color changed for ${e}, will re-render`),!0}return!1}(e,this.config);i?(s("Configuration changed, refreshing data"),this.updateEvents(!0)):r?(s("Entity colors changed, re-rendering without data refresh"),this.renderCard()):this.renderCard(),this.refreshTimer&&this.refreshTimer.start()}invalidateCache(){!function(t){try{const e=t.filter((t=>null!==localStorage.getItem(t)&&(localStorage.removeItem(t),!0)));e.length>0&&s(`Invalidated ${e.length} cache entries`)}catch(t){a("Failed to invalidate cache:",t)}}(A(x(this.instanceId,this.config.entities,this.config.days_to_show,this.config.show_past_events,this.config)))}getAllCacheKeys(){return A(this.getBaseCacheKey())}getCacheKey(){return this.getBaseCacheKey()}getBaseCacheKey(){const{entities:t,days_to_show:e,show_past_events:n}=this.config;return x(this.instanceId,t,e,n,this.config)}isValidState(){return w(this._hass,this.config.entities)}async updateEvents(t=!1){await $({hass:this._hass,config:this.config,instanceId:this.instanceId,force:t,currentEvents:this.events,callbacks:{setLoading:t=>{this.isLoading=t},setEvents:t=>{this.events=t},updateLastUpdate:()=>{this.performanceMetrics.lastUpdate=Date.now()},renderCallback:()=>{this.renderCard()}}})}handleAction(t){const e=k(this.config.entities);I(t,this._hass,this,e,(()=>this.toggleExpanded()))}toggleExpanded(){this.config.max_events_to_show&&(this.isExpanded=!this.isExpanded,setTimeout((()=>this.renderCard()),500))}formatEventTime(t){return f(t,this.config,this.config.language)}getTimeWindow(){return b(this.config.days_to_show)}async renderCard(){var t,e;const n=this.performanceTracker.beginMeasurement(this.events.length);if(!this.isValidState())return K(this.shadowRoot,"error",this.config),void this.performanceTracker.endMeasurement(n,this.performanceMetrics);if(this.isLoading)return K(this.shadowRoot,"loading",this.config),void this.performanceTracker.endMeasurement(n,this.performanceMetrics);const i=function(t,e,n,i){const r={},o=new Date,a=new Date(o.getFullYear(),o.getMonth(),o.getDate()),s=new Date(a);s.setHours(23,59,59,999);const c=t.filter((t=>{if(!(null==t?void 0:t.start)||!(null==t?void 0:t.end))return!1;const n=t.start.dateTime?new Date(t.start.dateTime):t.start.date?new Date(t.start.date):null,i=t.end.dateTime?new Date(t.end.dateTime):t.end.date?new Date(t.end.date):null;if(!n||!i)return!1;const r=!t.start.dateTime;return!(!(n>=a&&n<=s||n>s)||!e.show_past_events&&!r&&i<o)}));if(0===c.length)return[];c.forEach((t=>{const n=t.start.dateTime?new Date(t.start.dateTime):t.start.date?new Date(t.start.date):null;if(!n)return;const o=n.toISOString().split("T")[0],a=p(i);r[o]||(r[o]={weekday:a.daysOfWeek[n.getDay()],day:n.getDate(),month:a.months[n.getMonth()],timestamp:n.getTime(),events:[]}),r[o].events.push({summary:t.summary||"",time:f(t,e,i),location:e.show_location?y(t.location||"",e.remove_location_country):"",start:t.start,end:t.end,_entityId:t._entityId})})),Object.values(r).forEach((t=>{t.events.sort(((t,e)=>(t.start.dateTime?new Date(t.start.dateTime).getTime():t.start.date?new Date(t.start.date).getTime():0)-(e.start.dateTime?new Date(e.start.dateTime).getTime():e.start.date?new Date(e.start.date).getTime():0)))}));let l=Object.values(r).sort(((t,e)=>t.timestamp-e.timestamp)).slice(0,e.days_to_show||3);if(e.max_events_to_show&&!n){let t=0;l=l.filter((n=>{var i;return!(t>=(null!==(i=e.max_events_to_show)&&void 0!==i?i:0)||(t+=n.events.length,0))}))}return l}(this.events,this.config,this.isExpanded,this.config.language);if(0===i.length)return K(this.shadowRoot,"empty",this.config),void this.performanceTracker.endMeasurement(n,this.performanceMetrics);try{c("Creating card structure");const{container:n,style:r}=await G(this.config,i,(t=>this.formatEventTime(t)),(t=>this.formatLocation(t)),H,F);this.interactionManager.cleanup&&(this.interactionManager.cleanup(),this.interactionManager.cleanup=null),J(this.shadowRoot);const o=k(this.config.entities),a=document.createElement("div");a.className="card-container",a.setAttribute("role","button"),a.setAttribute("tabindex","0");const s=document.createElement("calendar-ripple"),l=document.createElement("div");if(l.className="card-content",n instanceof HTMLElement)for(;n.firstChild;)l.appendChild(n.firstChild);a.appendChild(s),a.appendChild(l),null===(t=this.shadowRoot)||void 0===t||t.appendChild(r),null===(e=this.shadowRoot)||void 0===e||e.appendChild(a),this.interactionManager.container=a;const d=()=>{const t=t=>{this._hass&&(!this.interactionManager.state.holdTriggered&&this.config.tap_action&&(c("Executing tap action from mdw:action event"),I(this.config.tap_action,this._hass,a,o,(()=>this.toggleExpanded()))),this.interactionManager.state.holdTriggered=!1)};a.addEventListener("mdw:action",t),s instanceof HTMLElement&&"attach"in s&&s.attach(a);let e=null,n=null;const i=t=>{var i;n=t.pointerId,this.interactionManager.state.holdTriggered=!1,"none"!==(null===(i=this.config.hold_action)||void 0===i?void 0:i.action)&&(e&&clearTimeout(e),e=window.setTimeout((()=>{n===t.pointerId&&(c("Hold threshold reached"),this.interactionManager.state.holdTriggered=!0,this.interactionManager.state.holdIndicator=z(t))}),500))},r=t=>{n===t.pointerId&&(e&&(clearTimeout(e),e=null),n=null,this.interactionManager.state.holdTriggered&&this.config.hold_action&&(c("Executing hold action on pointer up"),I(this.config.hold_action,this._hass,a,o,(()=>this.toggleExpanded()))),this.interactionManager.state.holdIndicator&&(D(this.interactionManager.state.holdIndicator),this.interactionManager.state.holdIndicator=null))},l=()=>{e&&(clearTimeout(e),e=null),n=null,this.interactionManager.state.holdTriggered=!1,this.interactionManager.state.holdIndicator&&(D(this.interactionManager.state.holdIndicator),this.interactionManager.state.holdIndicator=null)},d=()=>{e&&(clearTimeout(e),e=null),n=null,this.interactionManager.state.holdTriggered=!1,this.interactionManager.state.holdIndicator&&(c("Removing hold indicator on pointer leave"),D(this.interactionManager.state.holdIndicator),this.interactionManager.state.holdIndicator=null)};a.addEventListener("pointerdown",i),a.addEventListener("pointerup",r),a.addEventListener("pointercancel",l),a.addEventListener("pointerleave",d);const h=t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),this.config.tap_action&&I(this.config.tap_action,this._hass,a,o,(()=>this.toggleExpanded())))};return a.addEventListener("keydown",h),()=>{a.removeEventListener("mdw:action",t),a.removeEventListener("keydown",h),a.removeEventListener("pointerdown",i),a.removeEventListener("pointerup",r),a.removeEventListener("pointercancel",l),a.removeEventListener("pointerleave",d),e&&clearTimeout(e),this.interactionManager.state.holdIndicator&&(D(this.interactionManager.state.holdIndicator),this.interactionManager.state.holdIndicator=null),s instanceof HTMLElement&&"detach"in s&&s.detach()}};this.interactionManager.cleanup=d()}catch(t){o("Render error:",t),K(this.shadowRoot,"error",this.config)}this.performanceTracker.endMeasurement(n,this.performanceMetrics)}connectedCallback(){var t;c("Connected callback called - checking if rendering needed");if(!((null===(t=this.shadowRoot)||void 0===t?void 0:t.childElementCount)&&this.shadowRoot.childElementCount>0)&&this._hass)return c("No content found after navigation - triggering render"),void this.renderCard();if(this.interactionManager.container&&!this.interactionManager.cleanup){const t=this.interactionManager.container.querySelector("calendar-ripple"),e=k(this.config.entities),n=this.interactionManager.container;if(t){let i=null,r=null;const o=t=>{var e;r=t.pointerId,this.interactionManager.state.holdTriggered=!1,"none"!==(null===(e=this.config.hold_action)||void 0===e?void 0:e.action)&&(i&&clearTimeout(i),i=window.setTimeout((()=>{r===t.pointerId&&(c("Hold threshold reached in connectedCallback"),this.interactionManager.state.holdTriggered=!0,this.interactionManager.state.holdIndicator=z(t))}),500))},a=t=>{r===t.pointerId&&(i&&(clearTimeout(i),i=null),r=null,this.interactionManager.state.holdTriggered&&this.config.hold_action&&(c("Executing hold action from connectedCallback"),I(this.config.hold_action,this._hass,n,e,(()=>this.toggleExpanded()))),this.interactionManager.state.holdIndicator&&(D(this.interactionManager.state.holdIndicator),this.interactionManager.state.holdIndicator=null))},s=()=>{i&&(clearTimeout(i),i=null),r=null,this.interactionManager.state.holdTriggered=!1,this.interactionManager.state.holdIndicator&&(D(this.interactionManager.state.holdIndicator),this.interactionManager.state.holdIndicator=null)},l=()=>{i&&(clearTimeout(i),i=null),r=null,this.interactionManager.state.holdTriggered=!1,this.interactionManager.state.holdIndicator&&(c("Removing hold indicator on pointer leave"),D(this.interactionManager.state.holdIndicator),this.interactionManager.state.holdIndicator=null)},d=t=>{this._hass&&(!this.interactionManager.state.holdTriggered&&this.config.tap_action&&I(this.config.tap_action,this._hass,n,e,(()=>this.toggleExpanded())),this.interactionManager.state.holdTriggered=!1)};n.addEventListener("mdw:action",d),n.addEventListener("pointerdown",o),n.addEventListener("pointerup",a),n.addEventListener("pointercancel",s),n.addEventListener("pointerleave",l),"attach"in t&&t.attach(n),this.interactionManager.cleanup=()=>{n.removeEventListener("mdw:action",d),n.removeEventListener("pointerdown",o),n.removeEventListener("pointerup",a),n.removeEventListener("pointercancel",s),n.removeEventListener("pointerleave",l),i&&clearTimeout(i),this.interactionManager.state.holdIndicator&&(D(this.interactionManager.state.holdIndicator),this.interactionManager.state.holdIndicator=null),"detach"in t&&t.detach()},c("Restored interaction handlers with hold support in connectedCallback")}}}generateCalendarContent(t){return function(t,e,n,i){return t.length?t.map((t=>0===t.events.length?"":`<table>${t.events.map(((r,o)=>{const a=T(r._entityId,e);return`\n      <tr>\n        ${0===o?`\n          <td class="date" rowspan="${t.events.length}">\n            <div class="date-content">\n              <div class="weekday">${t.weekday}</div>\n              <div class="day">${t.day}</div>\n              ${e.show_month?`<div class="month">${t.month}</div>`:""}\n            </div>\n          </td>\n        `:""}\n        <td class="event">\n          <div class="event-content">\n            <div class="event-title" style="color: ${a}">${r.summary}</div>\n            <div class="time-location">\n              <div class="time">\n                <ha-icon icon="hass:clock-outline"></ha-icon>\n                <span>${n(r)}</span>\n              </div>\n              ${r.location&&e.show_location?`\n                <div class="location">\n                  <ha-icon icon="hass:map-marker"></ha-icon>\n                  <span>${i(r.location)}</span>\n                </div>\n              `:""}\n            </div>\n          </div>\n        </td>\n      </tr>\n    `})).join("")}</table>`)).join(""):'<div class="no-events">No upcoming events</div>'}(t,this.config,(t=>this.formatEventTime(t)),(t=>this.formatLocation(t)))}generateDayContent(t){return V(t,this.config,(t=>this.formatEventTime(t)),(t=>this.formatLocation(t)))}getEntityColor(t){return T(t,this.config)}getStyles(){return B(this.config)}debounce(t,e){return L(t,e)}memoize(t){return R(t,this)}getAverageRenderTime(){return this.performanceTracker.getAverageRenderTime(this.performanceMetrics)}handleError(t){var e;o(`Error: ${(e=t)instanceof Error?e.message:String(e)}`),e instanceof Error&&e.stack&&console.error(e.stack)}}customElements.define("calendar-card-pro-dev",ie),customElements.define("calendar-card-pro-dev-editor",q),window.customCards=window.customCards||[],window.customCards.push({type:"calendar-card-pro-dev",name:"Calendar Card Pro",preview:!0,description:"A calendar card that supports multiple calendars with individual styling.",documentationURL:"https://github.com/alexpfau/calendar-card-pro"});export{ne as VERSION};
//# sourceMappingURL=calendar-card-pro.js.map
